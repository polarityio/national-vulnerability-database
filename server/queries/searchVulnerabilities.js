const { flow, map } = require('lodash/fp');
const { MAX_PAGE_SIZE } = require('../constants');
const { requestsInParallel } = require('../request');

const searchVulnerabilities = async (entities, options) =>
  flow(
    map((entity) => ({
      entity,
      route: 'cves/2.0',
      qs: {
        cveId: entity.value,
        resultsPerPage: MAX_PAGE_SIZE
      },
      options
    })),
    async (searchVulnerabilitiesRequests) =>
      await requestsInParallel(searchVulnerabilitiesRequests, 'body.vulnerabilities.0.cve')
  )(entities);

module.exports = searchVulnerabilities;
